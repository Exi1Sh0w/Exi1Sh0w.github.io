<!DOCTYPE html><html lang="zh_CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 命令执行 · Exi1Sh0w's Blog</title><meta name="description" content="努力努力再努力..."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Exi1Sh0w's Blog" type="application/atom+xml">
</head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="https://github.com/exi1sh0w" target="_blank" class="nav-link">github</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2019/01/16/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="post-title-link">命令执行</a></h2><div class="post-meta"><div class="post-time">2019年1月16日 星期三</div></div><div class="post-content"><h2 id="在书里看到一个算是小技巧吧"><a href="#在书里看到一个算是小技巧吧" class="headerlink" title="在书里看到一个算是小技巧吧"></a>在书里看到一个算是小技巧吧</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用两个花括号进行特殊构造，使函数能够执行</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&#123;$&#123;phpinfo()&#125;&#125;"</span>;</span><br></pre></td></tr></table></figure>



<p>Demo：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;简单ping功能&lt;/title&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        请输入IP:&lt;input name=<span class="string">"ip"</span> type=<span class="string">"text"</span>&gt;&lt;br&gt;</span><br><span class="line">        &lt;input name=<span class="string">"submit"</span> type=<span class="string">"submit"</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $target = $_POST[<span class="string">'ip'</span>];</span><br><span class="line">    <span class="comment">// 使用php_uname判断是否为Windows系统</span></span><br><span class="line">    <span class="keyword">if</span> (stristr(php_uname(<span class="string">'s'</span>), <span class="string">'Windows NT'</span>))&#123;</span><br><span class="line">        $cmd = shell_exec(<span class="string">'ping '</span> .$target);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>.$cmd.<span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $cmd = shell_exec(<span class="string">'ping -c 3 '</span> .$target);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>.$cmd.<span class="string">'&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="防御措施"><a href="#防御措施" class="headerlink" title="防御措施"></a>防御措施</h2><p>1.禁用部分函数：<br>    打开php.ini,查找到disable_functions,添加需要禁用的函数名：<br>    PHPinfo()/eval()/passthru()/exec()/system()/chroot()/scandir()/chgrp()/chown()/shell_exec()/proc_open()/<br>    proc_get_status()/ini_alter()/ini_restore()/dl()/pfsockopen()/openlog()/syslog()/readlink()/symlink()/<br>    popepassthru()/stream_socket_server()/fsocket()/fsockopen()</p>
<p>2.过滤关键字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$substitutions = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'&amp;&amp;'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    <span class="string">';'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    <span class="string">'||'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">)</span><br><span class="line">$target = str_replace(array_keys($subtitutions), $subtitutions, $target);</span><br></pre></td></tr></table></figure>

<p>3.限制参数类型</p>
<p>​    比如Demo，是一个pingIP的程序，可以限制只能输入数字</p>
</div></article><div class="pagination"><a href="/2019/03/06/%E5%90%8E%E9%97%A8%E5%BD%92%E7%B1%BB/" class="pagination-prev">PREV</a><a href="/2019/01/14/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="pagination-next">NEXT</a></div><div class="comments"></div></div><aside class="sidebar"><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/26/WebLogic-wls9-async-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">WebLogic_wls9-async_反序列化漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/06/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/">Nodejs的一些问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/02/xss%E8%AE%B0%E5%BD%95/">xss记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/15/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/">逻辑漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/06/%E5%90%8E%E9%97%A8%E5%BD%92%E7%B1%BB/">后门归类</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/16/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">命令执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/14/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传的攻击/防御</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/03/Markdown%E7%BC%96%E8%BE%91%E5%99%A8typora_xss/">Markdown编辑器typora_xss</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2020 <a href="/">Exi1Sh0w</P></div><div class="power"><p><a href="http://pinggod.com/" target="_blank" rel="noopener">Sean Sun</a>, 
<a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>, 
<a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>, 
<a href="https://jekyllrb.com/" target="_blank" rel="noopener">Jekyll</a></p></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80781234-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ee75cf111111aa99f8540efa2570970";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>